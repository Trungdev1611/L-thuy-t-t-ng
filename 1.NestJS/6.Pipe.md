# PIPE: dÃ¹ng Ä‘á»ƒ biáº¿n Ä‘á»•i dá»¯ liá»‡u Ä‘áº§u vÃ o (transformation) vÃ  validate dá»¯ liá»‡u Ä‘áº§u vÃ o
Pipe = Kiá»ƒm tra + Chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u Ä‘áº§u vÃ o

1. âœ… Validation (Kiá»ƒm tra há»£p lá»‡)
VÃ­ dá»¥: kiá»ƒm tra xem age cÃ³ pháº£i lÃ  sá»‘ nguyÃªn dÆ°Æ¡ng khÃ´ng, hoáº·c email cÃ³ Ä‘Ãºng Ä‘á»‹nh dáº¡ng khÃ´ng.

2. ğŸ”„ Transformation (Chuyá»ƒn Ä‘á»•i kiá»ƒu dá»¯ liá»‡u)
VÃ­ dá»¥: chuyá»ƒn query.id tá»« "123" (string) sang 123 (number).

# VÃ­ dá»¥ 1: Pipe máº·c Ä‘á»‹nh cÃ³ sáºµn
ts
Copy
Edit
@Get(':id')
getUser(@Param('id', ParseIntPipe) id: number) {
  // ParseIntPipe sáº½ chuyá»ƒn 'id' tá»« string thÃ nh number
  return this.userService.findById(id);
}

hoáº·c 
@Controller('users')
export class UserController {
  @Get(':id')
  @UsePipes(ParseIntPipe)
  getById(@Param('id') id: number) {
    return { id }; // vÃ­ dá»¥ tráº£ vá» id Ä‘Ã£ parse
  }
}

# VÃ­ dá»¥ 2: Tá»± táº¡o Pipe Ä‘á»ƒ validate email
// email-validation.pipe.ts
import { PipeTransform, Injectable, BadRequestException } from '@nestjs/common';

@Injectable()
export class EmailValidationPipe implements PipeTransform {
  transform(value: any) {
    const emailRegex = /\S+@\S+\.\S+/;
    if (!emailRegex.test(value)) {
      throw new BadRequestException('Email khÃ´ng há»£p lá»‡');
    }
    return value;
  }
}


Sá»­ dá»¥ng trong controller:
@Post()
createUser(@Body('email', EmailValidationPipe) email: string) {
  return this.userService.create({ email });
}

hoáº·c 

@Controller('users')
export class UserController {
  @Post('validate-email')
  @UsePipes(new EmailValidationPipe())
  createUser(@Body('email') email: string) {
    return { email };
  }
}
# VÃ­ dá»¥ 3: CÃ¡ch dÃ¹ng DTO vÃ  validationPipe cÃ³ sáºµn (phá»• biáº¿n nháº¥t)
import { IsEmail, IsNotEmpty } from 'class-validator';

export class CreateUserDto {
  @IsEmail()
  email: string;

  @IsNotEmpty()
  password: string;
}

@Post()
@UsePipes(new ValidationPipe()) //dÃ¹ng á»Ÿ Ä‘Ã¢y rá»“i thÃ¬ bá» ValidationPipe dÆ°á»›i Ä‘i, chá»‰ cáº§n khai bÃ¡o 1 nÆ¡i
create(@Body(new ValidationPipe()) dto: CreateUserDto) {  
  return this.userService.create(dto);
}